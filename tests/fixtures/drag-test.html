<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drag Test</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, sans-serif;
      padding: 20px;
      background: #1a1a2e;
      color: #eee;
    }
    h1 { margin: 0 0 20px; font-size: 1.5rem; }
    .container {
      display: flex;
      gap: 40px;
      margin-bottom: 30px;
    }
    .zone {
      width: 200px;
      height: 200px;
      border: 2px dashed #444;
      border-radius: 8px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .zone.highlight {
      border-color: #4ade80;
      background: rgba(74, 222, 128, 0.1);
    }
    .zone h2 {
      margin: 0;
      font-size: 0.875rem;
      color: #888;
    }
    .item {
      padding: 12px 16px;
      background: #3b82f6;
      border-radius: 6px;
      cursor: grab;
      user-select: none;
      touch-action: none;
    }
    .item:active { cursor: grabbing; }
    .item.dragging {
      opacity: 0.5;
      background: #60a5fa;
    }
    #dropzone {
      border-color: #f59e0b;
      min-height: 200px;
    }
    #dropzone.highlight {
      border-color: #4ade80;
      background: rgba(74, 222, 128, 0.1);
    }
    .log {
      background: #0f0f1a;
      border-radius: 8px;
      padding: 15px;
      font-family: monospace;
      font-size: 0.8rem;
      max-height: 200px;
      overflow-y: auto;
    }
    .log-entry { margin: 4px 0; }
    .log-entry.mouse { color: #60a5fa; }
    .log-entry.touch { color: #f472b6; }
    .log-entry.drop { color: #4ade80; }
    #slider-container {
      margin-top: 20px;
      padding: 20px;
      background: #252540;
      border-radius: 8px;
    }
    #slider-track {
      width: 300px;
      height: 8px;
      background: #444;
      border-radius: 4px;
      position: relative;
      margin: 20px 0;
    }
    #slider-handle {
      width: 24px;
      height: 24px;
      background: #8b5cf6;
      border-radius: 50%;
      position: absolute;
      top: -8px;
      left: 0;
      cursor: grab;
      touch-action: none;
    }
    #slider-handle:active { cursor: grabbing; }
    #slider-value {
      font-size: 1.25rem;
      color: #8b5cf6;
    }
  </style>
</head>
<body>
  <h1>Drag Test Page</h1>

  <div class="container">
    <div class="zone" id="source">
      <h2>Drag Items</h2>
      <div class="item" id="item1" draggable="true">Item 1</div>
      <div class="item" id="item2" draggable="true">Item 2</div>
      <div class="item" id="item3" draggable="true">Item 3</div>
    </div>

    <div class="zone" id="dropzone">
      <h2>Drop Zone</h2>
    </div>
  </div>

  <div id="slider-container">
    <h2>Slider (drag handle)</h2>
    <div id="slider-track">
      <div id="slider-handle"></div>
    </div>
    <div>Value: <span id="slider-value">0</span>%</div>
  </div>

  <h2 style="margin-top: 30px; font-size: 1rem;">Event Log</h2>
  <div class="log" id="log"></div>

  <script>
    const log = document.getElementById('log');
    const dropzone = document.getElementById('dropzone');
    const sliderTrack = document.getElementById('slider-track');
    const sliderHandle = document.getElementById('slider-handle');
    const sliderValue = document.getElementById('slider-value');

    function addLog(msg, type = '') {
      const entry = document.createElement('div');
      entry.className = 'log-entry ' + type;
      entry.textContent = `${new Date().toLocaleTimeString()}: ${msg}`;
      log.insertBefore(entry, log.firstChild);
      if (log.children.length > 50) log.removeChild(log.lastChild);
    }

    // Mouse drag events
    let draggedItem = null;

    document.querySelectorAll('.item').forEach(item => {
      item.addEventListener('dragstart', (e) => {
        draggedItem = e.target;
        e.target.classList.add('dragging');
        addLog(`Mouse dragstart: ${e.target.textContent}`, 'mouse');
      });

      item.addEventListener('dragend', (e) => {
        e.target.classList.remove('dragging');
        addLog(`Mouse dragend: ${e.target.textContent}`, 'mouse');
        draggedItem = null;
      });

      // Touch events for items
      let touchStartX, touchStartY;

      item.addEventListener('touchstart', (e) => {
        const touch = e.touches[0];
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
        item.classList.add('dragging');
        addLog(`Touch start: ${item.textContent} at (${Math.round(touch.clientX)}, ${Math.round(touch.clientY)})`, 'touch');
      });

      item.addEventListener('touchmove', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        addLog(`Touch move: ${item.textContent} at (${Math.round(touch.clientX)}, ${Math.round(touch.clientY)})`, 'touch');

        // Check if over dropzone
        const rect = dropzone.getBoundingClientRect();
        if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
            touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
          dropzone.classList.add('highlight');
        } else {
          dropzone.classList.remove('highlight');
        }
      });

      item.addEventListener('touchend', (e) => {
        item.classList.remove('dragging');
        const touch = e.changedTouches[0];
        addLog(`Touch end: ${item.textContent} at (${Math.round(touch.clientX)}, ${Math.round(touch.clientY)})`, 'touch');

        // Check drop
        const rect = dropzone.getBoundingClientRect();
        if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
            touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
          dropzone.appendChild(item);
          addLog(`Touch drop: ${item.textContent} moved to dropzone`, 'drop');
        }
        dropzone.classList.remove('highlight');
      });
    });

    // Dropzone events (mouse)
    dropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropzone.classList.add('highlight');
    });

    dropzone.addEventListener('dragleave', () => {
      dropzone.classList.remove('highlight');
    });

    dropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropzone.classList.remove('highlight');
      if (draggedItem) {
        dropzone.appendChild(draggedItem);
        addLog(`Mouse drop: ${draggedItem.textContent} moved to dropzone`, 'drop');
      }
    });

    // Slider functionality
    let isDraggingSlider = false;

    function updateSlider(clientX) {
      const rect = sliderTrack.getBoundingClientRect();
      let percent = ((clientX - rect.left) / rect.width) * 100;
      percent = Math.max(0, Math.min(100, percent));
      sliderHandle.style.left = `calc(${percent}% - 12px)`;
      sliderValue.textContent = Math.round(percent);
    }

    sliderHandle.addEventListener('mousedown', (e) => {
      isDraggingSlider = true;
      addLog(`Slider mousedown at ${Math.round(e.clientX)}`, 'mouse');
    });

    document.addEventListener('mousemove', (e) => {
      if (isDraggingSlider) {
        updateSlider(e.clientX);
        addLog(`Slider mousemove to ${sliderValue.textContent}%`, 'mouse');
      }
    });

    document.addEventListener('mouseup', () => {
      if (isDraggingSlider) {
        isDraggingSlider = false;
        addLog(`Slider mouseup at ${sliderValue.textContent}%`, 'mouse');
      }
    });

    // Touch slider
    sliderHandle.addEventListener('touchstart', (e) => {
      e.preventDefault();
      addLog(`Slider touchstart`, 'touch');
    });

    sliderHandle.addEventListener('touchmove', (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      updateSlider(touch.clientX);
      addLog(`Slider touchmove to ${sliderValue.textContent}%`, 'touch');
    });

    sliderHandle.addEventListener('touchend', () => {
      addLog(`Slider touchend at ${sliderValue.textContent}%`, 'touch');
    });

    addLog('Page loaded - ready for drag testing', 'drop');
  </script>
</body>
</html>
